<!-- Hero Header Section -->
<div class="app-hero gallery-hero">
    <div class="app-hero-content hero-content">
        <div class="app-hero-title-section hero-title-section">
            <div class="app-hero-icon hero-icon">
                <i class="pi pi-video"></i>
            </div>
            <div class="app-hero-text hero-text">
                <h1 class="app-hero-title hero-title">{{ 'videos.gallery.title' | translate }}</h1>
                <p class="app-hero-subtitle hero-subtitle">{{ 'videos.gallery.subtitle' | translate }}</p>
            </div>
        </div>

        <!-- @if (credits(); as creditInfo) {
            <div class="app-credits-badge">
                <div class="app-credits-icon">
                    <i class="pi pi-star-fill"></i>
                </div>
                <div class="app-credits-info">
                    <span class="app-credits-label">{{ 'subscription.activeSubscription.creditsLabel' | translate }}</span>
                    <span class="app-credits-value">{{ creditInfo.totalCredits }} / {{ creditInfo.monthlyAllocation }}</span>
                </div>
                <div class="app-credits-bar">
                    <div class="app-credits-fill" [style.width.%]="(creditInfo.totalCredits / creditInfo.monthlyAllocation) * 100"></div>
                </div>
            </div>
        } -->
    </div>
</div>

<!-- Search & Filters Section -->
<div class="app-filters-section">
    <div class="app-filters-card">
        <!-- Search Bar -->
        <div class="app-search-container">
            <div class="app-search-input-wrapper">
                <i class="pi pi-search app-search-icon"></i>
                <input type="text" class="app-search-input" [(ngModel)]="searchTerm" [placeholder]="'videos.search.placeholder' | translate" (input)="onSearchChange()" />
                <button *ngIf="searchTerm" class="app-search-clear" (click)="searchTerm = ''; onSearchChange()">
                    <i class="pi pi-times"></i>
                </button>
            </div>
        </div>

        <!-- Filter Pills -->
        <div class="app-filters-row">
            <div class="app-filter-group">
                <p-select
                    [options]="sportOptions"
                    [(ngModel)]="selectedSport"
                    optionLabel="label"
                    optionValue="value"
                    [placeholder]="'videos.filter.sport' | translate"
                    (onChange)="onSportFilterChange()"
                    [showClear]="true"
                    styleClass="app-filter-select"
                />

                <p-select [options]="tagOptions" [(ngModel)]="selectedTag" optionLabel="label" optionValue="value" [placeholder]="'videos.filter.tag' | translate" (onChange)="onTagFilterChange()" [showClear]="true" styleClass="app-filter-select" />

                <p-select
                    [options]="countryOptions"
                    [(ngModel)]="selectedCountry"
                    optionLabel="label"
                    optionValue="value"
                    [placeholder]="'videos.filter.country' | translate"
                    (onChange)="onCountryFilterChange()"
                    [showClear]="true"
                    [filter]="true"
                    filterBy="label"
                    styleClass="app-filter-select"
                />

                <p-select
                    [(ngModel)]="selectedVideoFilterType"
                    [options]="videoFilterOptions"
                    optionLabel="label"
                    optionValue="value"
                    [placeholder]="'videos.filter.selectContactStatus' | translate"
                    (onChange)="onVideoFilterChange()"
                    [showClear]="true"
                    styleClass="app-filter-select"
                />
            </div>

            <!-- Gender Toggle -->
            <div class="app-gender-toggle-filter">
                <div *ngFor="let option of genreOptions" class="app-gender-option-filter">
                    <input type="radio" [id]="'genre-' + (option.value || 'all')" name="genre" [value]="option.value" [(ngModel)]="selectedGenre" (change)="onGenreFilterChange()" class="app-gender-radio-filter" />
                    <label [for]="'genre-' + (option.value || 'all')" class="app-gender-label-filter">
                        {{ option.label }}
                    </label>
                </div>
            </div>

            <!-- Clear Filters -->
            <button *ngIf="searchTerm || selectedSport || selectedTag || selectedCountry || selectedGenre || selectedVideoFilterType" class="app-clear-filters-btn" (click)="clearFilters()">
                <i class="pi pi-filter-slash"></i>
                <span>{{ 'videos.filter.clear' | translate }}</span>
            </button>
        </div>

        <!-- Active Filters Display -->
        <div *ngIf="searchTerm || selectedSport || selectedTag || selectedCountry || selectedGenre || selectedVideoFilterType" class="app-active-filters">
            <span class="app-active-filters-label">
                <i class="pi pi-filter"></i>
                {{ 'videos.filter.active' | translate }}:
            </span>
            <div class="app-filter-chips">
                <span *ngIf="searchTerm" class="app-filter-chip">
                    <i class="pi pi-search"></i>
                    "{{ searchTerm }}"
                    <button (click)="searchTerm = ''; onSearchChange()"><i class="pi pi-times"></i></button>
                </span>
                <span *ngIf="selectedSport" class="app-filter-chip">
                    <i class="pi pi-trophy"></i>
                    {{ getSportLabel(selectedSport) }}
                    <button (click)="selectedSport = null; onSportFilterChange()"><i class="pi pi-times"></i></button>
                </span>
                <span *ngIf="selectedTag" class="app-filter-chip">
                    <i class="pi pi-tag"></i>
                    {{ getTagLabel(selectedTag) }}
                    <button (click)="selectedTag = null; onTagFilterChange()"><i class="pi pi-times"></i></button>
                </span>
                <span *ngIf="selectedCountry" class="app-filter-chip">
                    <i class="pi pi-globe"></i>
                    {{ getCountryDisplay(selectedCountry) }}
                    <button (click)="selectedCountry = null; onCountryFilterChange()"><i class="pi pi-times"></i></button>
                </span>
            </div>
        </div>
    </div>
</div>

<!-- Loading State -->
<div *ngIf="loading()" class="loading-section">
    <div class="app-skeleton-grid">
        <div *ngFor="let i of [1, 2, 3, 4, 5, 6]" class="app-skeleton-card">
            <div class="app-skeleton-video"></div>
            <div class="app-skeleton-content">
                <div class="app-skeleton-title"></div>
                <div class="app-skeleton-meta"></div>
                <div class="app-skeleton-tags">
                    <div class="app-skeleton-tag"></div>
                    <div class="app-skeleton-tag"></div>
                </div>
                <div class="app-skeleton-button"></div>
            </div>
        </div>
    </div>
</div>

<!-- Videos Grid -->
<div *ngIf="!loading()" class="app-gallery-container" infiniteScroll [infiniteScrollDistance]="2" [infiniteScrollThrottle]="300" [scrollWindow]="isMobile" (scrolled)="onScroll($event)">
    <div *ngIf="videos().length > 0" class="app-videos-grid">
        <div *ngFor="let video of videos(); trackBy: trackByVideoId" class="app-video-card-wrapper">
            <div class="app-video-card">
                <!-- Video Player -->
                <div class="app-video-player-container">
                    <video #videoElement [attr.id]="'video-' + video.id" class="video-js vjs-default-skin" controls preload="metadata" [src]="getVideoThumbnail(video)"></video>

                    <!-- Video Overlay Badge -->
                    <div *ngIf="video?.prodige?.sport" class="app-video-sport-overlay">
                        <i class="pi pi-trophy"></i>
                        {{ getSportLabel(video.prodige.sport!) }}
                    </div>
                </div>

                <!-- Card Content -->
                <div class="app-card-content">
                    <!-- Athlete Header -->
                    <div class="app-athlete-header">
                        <div class="app-athlete-avatar">
                            {{ (video?.prodige?.nom || 'A').charAt(0).toUpperCase() }}
                        </div>
                        <div class="app-athlete-info">
                            <h3 class="app-athlete-name" [title]="video?.titre">
                                {{ formatVideoTitle(video?.titre) }}
                            </h3>
                            <div class="app-athlete-meta">
                                <span class="app-athlete-prodige">{{ video?.prodige?.nom || 'Unknown' }}</span>
                                <span *ngIf="video?.prodige?.pays" class="app-athlete-country">
                                    {{ getCountryDisplay(video.prodige.pays) }}
                                </span>
                            </div>
                        </div>
                        <div class="app-video-date-badge">
                            {{ video?.dateCreation | date: 'MMM d' }}
                        </div>
                        <button class="app-info-btn" (click)="openInfoDialog(video)" [title]="'videos.info.tooltip' | translate">
                            <i class="pi pi-info-circle"></i>
                        </button>
                    </div>

                    <!-- Description (always rendered for consistent height) -->
                    <p class="app-video-description">
                        {{ video?.description ? formatVideoDescription(video?.description) : '&nbsp;' }}
                    </p>

                    <!-- Tags (always rendered for consistent height) -->
                    <div class="app-tags-container">
                        <ng-container *ngIf="(video?.prodige?.tags?.length ?? 0) > 0">
                            <span *ngFor="let tag of video?.prodige?.tags?.slice(0, 3)" class="app-video-tag">
                                {{ getTagLabel(tag) }}
                            </span>
                            <span *ngIf="(video?.prodige?.tags?.length ?? 0) > 3" class="app-more-tags-badge"> +{{ getExtraTagsCount(video) }} </span>
                        </ng-container>
                    </div>

                    <!-- Contact Action -->
                    <div class="app-card-action">
                        <button class="app-contact-btn" (click)="openContactDialog(video)">
                            <i class="pi pi-send"></i>
                            <span>{{ 'videos.contact.button' | translate }}</span>
                            <i class="pi pi-arrow-right arrow-icon"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="!loading() && videos().length === 0" class="app-empty-state">
        <div class="app-empty-illustration">
            <div class="app-empty-circle">
                <i class="pi pi-video"></i>
            </div>
            <div class="app-empty-decorations">
                <span class="app-decoration d1"></span>
                <span class="app-decoration d2"></span>
                <span class="app-decoration d3"></span>
            </div>
        </div>
        <h2 class="app-empty-title">{{ 'videos.empty.title' | translate }}</h2>
        <p class="app-empty-description">{{ 'videos.empty.description' | translate }}</p>
        <button *ngIf="searchTerm || selectedSport || selectedTag || selectedCountry" class="app-empty-action" (click)="clearFilters()">
            <i class="pi pi-filter-slash"></i>
            {{ 'videos.filter.clear' | translate }}
        </button>
    </div>

    <!-- Load More Indicator -->
    <div *ngIf="hasMore() && videos().length > 0" class="app-load-more-indicator">
        <div class="app-loading-dots">
            <span></span>
            <span></span>
            <span></span>
        </div>
        <span>{{ 'videos.loading.more' | translate }}</span>
    </div>
</div>

<!-- Contact Dialog -->
<p-dialog [(visible)]="contactDialogVisible" [modal]="true" [header]="'videos.contact.dialog.header' | translate" [style]="{ width: '380px' }" [closable]="true" [draggable]="false" [resizable]="false" styleClass="app-contact-dialog-modern">
    <ng-template pTemplate="content">
        <div class="app-contact-dialog-content">
            <!-- Contact Avatar -->
            <div class="app-contact-avatar-section">
                <div class="app-contact-avatar">
                    {{ (getFullName() || 'A').charAt(0).toUpperCase() }}
                </div>
                <h3 class="app-contact-name">
                    {{ getFullName() || ('videos.contact.dialog.unknownContact' | translate) }}
                </h3>
                <span class="app-contact-sport">
                    {{ getSportLabel(selectedVideo?.prodige?.sport!) }}
                </span>
            </div>

            <!-- Contact Actions -->
            <div class="app-contact-actions">
                <a [href]="'mailto:' + getContactEmail(selectedVideo)" class="app-contact-action-btn email">
                    <i class="pi pi-envelope"></i>
                    <span>{{ 'videos.contact.dialog.email' | translate }}</span>
                </a>
                <a [href]="'tel:' + getContactPhone(selectedVideo)" class="app-contact-action-btn phone">
                    <i class="pi pi-phone"></i>
                    <span>{{ 'videos.contact.dialog.phone' | translate }}</span>
                </a>
                <a [href]="'sms:' + getContactPhone(selectedVideo)" class="app-contact-action-btn message">
                    <i class="pi pi-comment"></i>
                    <span>{{ 'videos.contact.dialog.message' | translate }}</span>
                </a>
            </div>

            <!-- Contact Details -->
            <div class="app-contact-details">
                <div class="app-contact-detail-item" (click)="copyToClipboard(getContactEmail(selectedVideo))" [title]="'videos.contact.dialog.copyEmailTitle' | translate">
                    <i class="pi pi-envelope"></i>
                    <span>{{ getContactEmail(selectedVideo) }}</span>
                    <i class="pi pi-copy copy-icon"></i>
                </div>
                <div class="app-contact-detail-item" (click)="copyToClipboard(getContactPhone(selectedVideo))" [title]="'videos.contact.dialog.copyPhoneTitle' | translate">
                    <i class="pi pi-phone"></i>
                    <span>{{ getContactPhone(selectedVideo) }}</span>
                    <i class="pi pi-copy copy-icon"></i>
                </div>
            </div>
        </div>
    </ng-template>

    <ng-template pTemplate="footer">
        <button class="app-dialog-close-btn" (click)="closeContactDialog()">
            {{ 'videos.contact.dialog.close' | translate }}
        </button>
    </ng-template>
</p-dialog>

<!-- Insufficient Credits Dialog -->
<p-dialog
    [(visible)]="insufficientCreditsDialogVisible"
    [modal]="true"
    [header]="'videos.insufficientCredits.dialog.header' | translate"
    [style]="{ width: '420px' }"
    [closable]="true"
    [draggable]="false"
    [resizable]="false"
    styleClass="app-credits-dialog-modern"
>
    <ng-template pTemplate="content">
        <div class="app-credits-dialog-content">
            <!-- Warning Illustration -->
            <div class="app-credits-warning-icon">
                <i class="pi pi-exclamation-triangle"></i>
            </div>

            <h3 class="app-credits-dialog-title">
                {{ 'videos.insufficientCredits.dialog.title' | translate }}
            </h3>
            <p class="app-credits-dialog-message">
                {{ insufficientCreditsErrorMessage || ('videos.insufficientCredits.dialog.message' | translate) }}
            </p>

            <!-- Current Credits -->
            @if (credits(); as creditInfo) {
                <div class="app-current-credits-display">
                    <i class="pi pi-star-fill"></i>
                    <span>{{ 'videos.insufficientCredits.dialog.currentCredits' | translate: { count: creditInfo.totalCredits } }}</span>
                </div>
            }

            <!-- Upgrade CTA -->
            <button class="app-upgrade-btn" (click)="navigateToSubscription()">
                <i class="pi pi-shopping-cart"></i>
                <span>{{ 'videos.insufficientCredits.dialog.subscribeButton' | translate }}</span>
            </button>
        </div>
    </ng-template>

    <ng-template pTemplate="footer">
        <button class="app-dialog-close-btn secondary" (click)="closeInsufficientCreditsDialog()">
            {{ 'videos.insufficientCredits.dialog.closeButton' | translate }}
        </button>
    </ng-template>
</p-dialog>

<!-- Video Info Dialog -->
<p-dialog
    [(visible)]="infoDialogVisible"
    [modal]="true"
    [header]="'videos.info.dialog.header' | translate"
    [style]="{ width: '500px', maxWidth: '95vw' }"
    [closable]="true"
    [draggable]="false"
    [resizable]="false"
    styleClass="app-info-dialog"
>
    <ng-template pTemplate="content">
        @if (infoDialogVideo) {
            <div class="app-info-dialog-content">
                <!-- Video Title -->
                <div class="app-info-section">
                    <h3 class="app-info-title">{{ infoDialogVideo.titre }}</h3>
                    <div class="app-info-meta">
                        <span class="app-info-prodige">
                            <i class="pi pi-user"></i>
                            {{ infoDialogVideo.prodige?.nom || 'Unknown' }}
                        </span>
                        <span *ngIf="infoDialogVideo.prodige?.sport" class="app-info-sport">
                            <i class="pi pi-trophy"></i>
                            {{ getSportLabel(infoDialogVideo.prodige!.sport!) }}
                        </span>
                        <span *ngIf="infoDialogVideo.prodige?.pays" class="app-info-country">
                            {{ getCountryDisplay(infoDialogVideo.prodige!.pays) }}
                        </span>
                    </div>
                </div>

                <!-- Full Description -->
                <div class="app-info-section">
                    <h4 class="app-info-label">
                        <i class="pi pi-align-left"></i>
                        {{ 'videos.info.dialog.description' | translate }}
                    </h4>
                    <p class="app-info-description">
                        {{ infoDialogVideo.description || ('videos.info.dialog.noDescription' | translate) }}
                    </p>
                </div>

                <!-- All Tags -->
                <div class="app-info-section" *ngIf="(infoDialogVideo.prodige?.tags?.length ?? 0) > 0">
                    <h4 class="app-info-label">
                        <i class="pi pi-tags"></i>
                        {{ 'videos.info.dialog.tags' | translate }}
                    </h4>
                    <div class="app-info-tags">
                        <span *ngFor="let tag of infoDialogVideo.prodige?.tags" class="app-info-tag">
                            {{ getTagLabel(tag) }}
                        </span>
                    </div>
                </div>
            </div>
        }
    </ng-template>

    <ng-template pTemplate="footer">
        <button class="app-dialog-close-btn" (click)="closeInfoDialog()">
            {{ 'videos.info.dialog.close' | translate }}
        </button>
    </ng-template>
</p-dialog>

<p-toast />
