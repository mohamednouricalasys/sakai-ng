<div class="subscription-wrapper">
    <!-- Loading State -->
    <div *ngIf="loading" class="loading-container">
        <p-progressSpinner styleClass="w-4rem h-4rem"></p-progressSpinner>
        <p class="mt-3 text-600">{{ 'subscription.loading' | translate }}</p>
    </div>

    <!-- Active Subscription Management -->
    <p-card *ngIf="!loading && subscriptionStatus?.isActive" [header]="'subscription.activeSubscription.title' | translate" styleClass="subscription-card">
        <div class="subscription-header">
            <div class="subscription-info">
                <h2 class="plan-name">{{ getPlanDisplayName(subscriptionStatus?.plan || '') }}</h2>
                <p class="credits-info">
                    <i class="pi pi-star-fill mr-2"></i>
                    {{ subscriptionStatus?.credits }} {{ 'subscription.activeSubscription.credits' | translate }}
                </p>
            </div>
            <p-tag [value]="'subscription.activeSubscription.status.active' | translate" severity="success" styleClass="status-tag">
                <i class="pi pi-check-circle mr-1"></i>
            </p-tag>
        </div>

        <p-divider></p-divider>

        <div class="action-buttons">
            <p-button [label]="'subscription.activeSubscription.buttons.manage' | translate" icon="pi pi-cog" styleClass="p-button-outlined mr-2" (click)="openCustomerPortal()" [loading]="actionLoading"> </p-button>

            <p-button [label]="'subscription.activeSubscription.buttons.cancel' | translate" icon="pi pi-times" severity="danger" styleClass="p-button-outlined" (click)="cancelSubscription()" [loading]="actionLoading"> </p-button>
        </div>
    </p-card>

    <!-- Pricing Table for New Subscriptions -->
    <p-card *ngIf="!loading && !subscriptionStatus?.isActive" [header]="'subscription.pricing.title' | translate" styleClass="pricing-card">
        <div class="pricing-intro">
            <h3>{{ 'subscription.pricing.subtitle' | translate }}</h3>
            <p class="text-600 mb-4">{{ 'subscription.pricing.description' | translate }}</p>
        </div>

        <div id="pricing-table-container" class="pricing-container">
            <p-progressSpinner *ngIf="loadingPricing" styleClass="w-3rem h-3rem"> </p-progressSpinner>
            <!-- Stripe Pricing Table will be dynamically loaded here -->
        </div>
    </p-card>

    <!-- Status Messages -->
    <p-message *ngIf="message" [severity]="message.type" [text]="message.text" styleClass="mt-3"> </p-message>
</div>
