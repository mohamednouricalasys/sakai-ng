<!-- components/subscription/subscription.component.html -->
<div class="subscription-container">
    <p-card header="Gestion de l'abonnement">
        <ng-container *ngIf="!isLoading; else loadingTemplate">
            <!-- Aucun abonnement actif -->
            <div *ngIf="!hasActiveSubscription" class="no-subscription">
                <div class="pricing-info">
                    <h3>Abonnement Premium</h3>
                    <div class="price">
                        <span class="amount">19.99€</span>
                        <span class="period">/mois</span>
                    </div>
                    <ul class="features">
                        <li><i class="pi pi-check"></i> Accès illimité aux contenus</li>
                        <li><i class="pi pi-check"></i> Support prioritaire</li>
                        <li><i class="pi pi-check"></i> Fonctionnalités avancées</li>
                        <li><i class="pi pi-check"></i> Sans engagement</li>
                    </ul>
                </div>

                <p-button label="S'abonner maintenant" icon="pi pi-credit-card" (onClick)="startSubscription()" [loading]="isLoading" styleClass="p-button-lg p-button-success"> </p-button>
            </div>

            <!-- Abonnement actif -->
            <div *ngIf="hasActiveSubscription" class="active-subscription">
                <div class="subscription-status">
                    <i class="pi pi-check-circle success-icon"></i>
                    <h3>Abonnement Actif</h3>
                    <p>Votre abonnement est actif depuis le {{ subscription?.createdAt | date: 'dd/MM/yyyy' }}</p>
                    <p-tag severity="success" value="Premium" icon="pi pi-crown"></p-tag>
                </div>

                <div class="subscription-actions">
                    <p-button label="Annuler l'abonnement" icon="pi pi-times" (onClick)="cancelSubscription()" [loading]="isLoading" styleClass="p-button-outlined p-button-danger"> </p-button>
                </div>

                <div class="subscription-info">
                    <p><small> Votre abonnement sera automatiquement renouvelé. Vous pouvez l'annuler à tout moment. </small></p>
                </div>
            </div>
        </ng-container>

        <ng-template #loadingTemplate>
            <div class="loading-container">
                <p-progressSpinner></p-progressSpinner>
                <p>Chargement...</p>
            </div>
        </ng-template>
    </p-card>

    <stripe-pricing-table pricing-table-id="prctbl_1S8q13F2oKbUh7puDk4ZAZn7" publishable-key="pk_test_51S52ecF2oKbUh7puM2WQUFwJqdBuxyZ19JKoguoPUhRMTF1B7EJU4S9AWQXuaAXmx9VEaMu4pd197fVNkXzLKRNc00e4c3bQ2t" [custumer-sesssion-client-secret]="sessionId">
    </stripe-pricing-table>
</div>
